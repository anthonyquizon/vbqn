
init_c â† "../lib.so" â€¢FFI ""â€¿"init"
input_c â† "../lib.so" â€¢FFI "a"â€¿"input"
lfâ†@+10â€¿13
winâ†2 # window of lines previous and next to current line

srcâ†@

# Lookup table
systableâ†âŸ¨
  "type"â€¿"out"â€¿"show"
  â€¢Type â€¿â€¢Out â€¿â€¢Show 
âŸ©

  # Lookup table
FindSys â† {
  i â† ğ•¨âŠğ•©
  { ! âˆ¾âŸ¨"Unknown system value",(1â‰ â‰ ğ•©)/"s",":"âŸ©âˆ¾" â€¢"âŠ¸âˆ¾Â¨ğ•© }âˆ˜/âŸœğ•©âŸ(âˆ¨Â´) i=â‰ ğ•¨
  i
}
system â† {ğ•¨âŠ¸FindSysâŠğ•©Ë™}Â´systable

PrintLines â† { src ğ•Š n:
  lâ†âˆ¾âŸ¨Â¯1â†“âŒ½n-â†•win,n+â†•winâŸ©
  lâ†©l/Ëœ(lâ‰¥0)âˆ§l<â‰ src
  arrâ† âŠ£â—¶""â€¿" <"Â¨(n=l)
  â€¢Out lnâ†1â†“âˆ¾lfâŠ¸âˆ¾Â¨(âˆ¾âŸœ"   "âˆ˜â€¢FmtÂ¨l) âˆ¾Â¨ (srcâŠËœl) âˆ¾Â¨ arr
  â€¢Out ""
}

cbâ†@ # TODO delete
# TODO line /character positions
Catchâ†{ğ•Š: â€¢Out "Error: " âˆ¾ â€¢Fmt â€¢CurrentError @ â‹„ âŸ¨âŸ©}

# f: file
# TODO repl history
Repl â‡ {
  ğ•Š env:
    Init_c âŸ¨âŸ©

    Fâ†â€¢ReBqn {replâ‡"loose"}
    # TODO load data
    { ğ•Š:
      lâ†Input_c âŸ¨âŸ© # TODO convert utf-8 to Unicode code point
      â€¢ExitâŸ(l=0) 0
      F l
      #env Eval l
    }â€¢_while_ 1 1
}

Repl @

# TODO query sql
  # if none reified: 
    # run functions with call values again


#srcâ†©â€¢file.Chars "../test/foo.bqn"
###â€¢Show 14âŠ‘runtime
##runtimeâ†©{ğ•Š:+}Â¨âŒ¾(0âŠ¸âŠ) runtime
##runtimeâ†©{ğ•Š:â†•}Â¨âŒ¾(14âŠ¸âŠ) runtime
#c â† âŸ¨runtime, { System ğ•© }, âŸ¨âŸ©âŸ© Compile src
#@â€¿cbâ€¿3â€¿src VM c
