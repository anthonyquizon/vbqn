gl      â†    â€¢Import "./glyphs.bqn"
compile â† gl â€¢Import "./c.bqn"
vm      â†    â€¢Import "./vm.bqn"
global  â†    â€¢Import "./global.bqn"

systemâ‡@
runtimeâ‡âŸ¨
 +,-,Ã—,Ã·,â‹†,âˆš,âŒŠ,âŒˆ,|,Â¬,âˆ§,âˆ¨,<,>,â‰ ,=,â‰¤,â‰¥,â‰¡,â‰¢,âŠ£,âŠ¢,â¥Š,âˆ¾,â‰,â‹ˆ,â†‘,â†“,â†•,Â«,Â»,âŒ½,â‰,/,â‹,â’,âŠ,âŠ‘,âŠ,âŠ’,âˆŠ,â·,âŠ”,!,
 Ë™,Ëœ,Ë˜,Â¨,âŒœ,â¼,Â´,Ë,`,
 âˆ˜,â—‹,âŠ¸,âŸœ,âŒ¾,âŠ˜,â—¶,â‰,âš‡,âŸ,âŠ,
âŸ©

impâ†âŸ¨âŸ© â€¢HashMap âŸ¨âŸ© #cached imported files

Import â† {
  # TODO import with args
  # TODO store call in graph

  imp.Has ğ•© ? imp.Get ğ•©;
  ğ•© : 
    âŸ¨cwd, Â·âŸ©â†global.ctx.Peek @

    fileâ†cwdâˆ¾ğ•©
    srcâ†â€¢file.Chars file
    cwdâ†©â€¢file.Parent file
    global.ctx.Push âŸ¨cwd,srcâŸ©

    câ† âŸ¨runtime, { System ğ•© }, âŸ¨âŸ©âŸ© Compile src
    râ†VM c
    global.ctx.Pop 1
    ğ•© imp.Set r
    r
}
# Lookup table
systableâ† âˆ¾<Ë˜â‹ˆË˜â‰>âŸ¨
    "type"â€¿â€¢Type
     "out"â€¿â€¢Out
    "show"â€¿â€¢Show
  "import"â€¿Import
âŸ©

FindSys â† {
  i â† ğ•¨âŠğ•©
  { ! âˆ¾âŸ¨"Unknown system value",(1â‰ â‰ ğ•©)/"s",":"âŸ©âˆ¾" â€¢"âŠ¸âˆ¾Â¨ğ•© }âˆ˜/âŸœğ•©âŸ(âˆ¨Â´) i=â‰ ğ•¨
  i
}

systemâ†©{ ğ•¨âŠ¸FindSysâŠğ•©Ë™ }Â´systable

