
#MakeStack â† {
  #s â‡ ğ•©                                                                                               # Stack (a list)
  #Push â‡ {sâˆ¾â†©<ğ•© â‹„ ğ•©}                                                                                  # Push a value
  #Pop  â‡ {tâ†-ğ•© â‹„ (sâ†“Ëœâ†©t) âŠ¢ âŒ½tâ†‘s}                                                                      # Pop ğ•© values; return as list
  #Peek â‡ {ğ•Š: 0=â‰ s ? âŸ¨âŸ©;Â¯1âŠ‘s}                                                                          # Return but don't pop top value
#}


lfâ†@+10

bodym â‡ âŸ¨âŸ© â€¢HashMap âŸ¨âŸ©
refm  â‡ âŸ¨âŸ© â€¢HashMap âŸ¨âŸ©
valm  â‡ âŸ¨âŸ© â€¢HashMap âŸ¨âŸ©
filem â‡ âŸ¨âŸ© â€¢HashMap âŸ¨âŸ©


MakeStack â† {
  s â‡ ğ•©                          # Stack (a list)
  Push â‡ {sâˆ¾â†©<ğ•© â‹„ ğ•©}                 # Push a value
  Pop  â‡ {tâ†-ğ•© â‹„ (sâ†“Ëœâ†©t) âŠ¢ âŒ½tâ†‘s} # Pop ğ•© values; return as list
  Peek â‡ {ğ•Š: 0=â‰ s ? âŸ¨âŸ©;Â¯1âŠ‘s}                # Return but don't pop top value
}

ctx â‡ {
  s â‡ MakeStack âŸ¨âŸ©

  Push â‡ { args ğ•Š ğ•©:
    fâ†ğ•©âˆ¾Ëœ(0âŠ¸â‰¢â‰ )â—¶""â€¿(â€¢ns.GetâŸœ"cwd") s.Peek @

    Cacheâ†{
      file  â‡ f
      args  â‡ args 
      src   â‡ â€¢file.Chars ğ•© 
      cols  â‡ âˆ¾+`Â¨1Â¨Â¨âŠ”+`src=lf
      lines â‡ 1++`src=lf 
    }
    (filem.SetâŸœCache)âŸ(Â¬âˆ˜filem.Has) f
    s.Push { cwdâ‡â€¢file.Parent f }
    filem.Get f
  }

  Peek â‡ s.Peek
  Pop  â‡ s.Pop
}


bodiesâ‡{
  sâ‡âŸ¨âŸ©
  Pushâ‡{ fğ•Ši: @ }
  Popâ‡{ğ•©}
}

valâ‡{
  Recâ‡{ğ•©}
}
